<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdminRepartos (Firebase)</title>
    <!-- Estilos -->
    <link rel="stylesheet" href="styles.css">
    <!-- LibrerÃ­as externas -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.2/package/dist/xlsx.full.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-storage-compat.js"></script>
</head>
<body>
<div id="app">
    <header>
        <h1>ğŸ“¦ AdminRepartos</h1>
        <button class="nav-btn" data-view="orders">ğŸ“‹ Pedidos</button>
        <button class="nav-btn" data-view="customers">ğŸ‘¥ Clientes</button>
        <button class="nav-btn" data-view="products">ğŸ“¦ Productos</button>
        <button class="nav-btn" data-view="backup">ğŸ’¾ Backup</button>
    </header>
    <main>
        <div class="views-container" id="viewsContainer">
            <!-- Pedidos -->
            <div id="view-orders" class="active-view">
                <div class="flex-row">
                    <h2>ğŸ“‹ Lista de Pedidos</h2>
                    <button id="newOrderBtn" class="secondary">â• Nuevo pedido</button>
                </div>
                <div class="flex-row">
                    <input type="text" id="searchOrders" class="search-box" placeholder="ğŸ” Buscar...">
                    <div class="filter-group">
                        <select id="statusFilter">
                            <option value="todos">Todos</option>
                            <option value="pendiente">Pendiente</option>
                            <option value="entregado">Entregado</option>
                            <option value="incompleto">Incompleto</option>
                        </select>
                        <div class="date-filter">
                            <input type="date" id="dateFrom" placeholder="Desde">
                            <input type="date" id="dateTo" placeholder="Hasta">
                        </div>
                    </div>
                </div>
                <div id="ordersList"></div>
            </div>
            <!-- Clientes -->
            <div id="view-customers">
                <div class="flex-row">
                    <h2>ğŸ‘¥ Clientes</h2>
                    <button id="newCustomerBtn" class="secondary">â• Nuevo cliente</button>
                </div>
                <div id="customersList"></div>
            </div>
            <!-- Productos -->
            <div id="view-products">
                <h2>ğŸ“¦ Productos</h2>
                <div class="card">
                    <p>SubÃ­ un archivo CSV o Excel para cargar productos.</p>
                    <div class="file-upload" id="dropZone">
                        ğŸ“‚ ArrastrÃ¡ o hacÃ© clic
                        <input type="file" id="productFile" accept=".csv, .xls, .xlsx" style="display: none;">
                    </div>
                    <div id="productList" style="margin-top:2rem"></div>
                    <button id="clearProducts" class="secondary" style="margin-top:1rem">ğŸ—‘ï¸ Limpiar todos</button>
                </div>
            </div>
            <!-- Backup -->
            <div id="view-backup">
                <h2>ğŸ’¾ Respaldos</h2>
                <div class="card">
                    <button id="exportBackup" style="width:100%; margin-bottom:1rem">ğŸ“¥ Exportar backup</button>
                    <div class="file-upload" id="importZone">
                        ğŸ“‚ Restaurar backup (JSON)
                        <input type="file" id="importFile" accept=".json" style="display: none;">
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Modales -->
<div id="orderModal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); align-items:center; justify-content:center; z-index:1000;">
    <div style="background:white; border-radius:30px; width:90%; max-width:800px; max-height:90vh; overflow:auto; padding:2rem;">
        <h3 id="modalTitle">â• Nuevo Pedido</h3>
        <form id="orderForm">
            <input type="hidden" id="orderId">
            <div class="form-grid">
                <div>
                    <div class="form-group">
                        <label>Cliente</label>
                        <div class="inline-add">
                            <select id="customerSelect" required></select>
                            <button type="button" id="quickAddCustomerBtn" class="secondary" style="width:40px; height:40px; border-radius:50%;">â•</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Fecha</label>
                        <input type="datetime-local" id="orderDate" required>
                    </div>
                    <div class="form-group">
                        <label>Estado</label>
                        <select id="orderStatus">
                            <option value="pendiente">Pendiente</option>
                            <option value="entregado">Entregado</option>
                            <option value="incompleto">Incompleto</option>
                        </select>
                    </div>
                </div>
                <div>
                    <div class="form-group">
                        <label>Comentarios</label>
                        <textarea id="orderComments" placeholder="Notas..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Ticket (Imagen o PDF)</label>
                        <input type="file" id="ticketPhoto" accept="image/*,application/pdf">
                        <div id="photoPreviewContainer"></div>
                    </div>
                </div>
            </div>
            <fieldset style="border:1px solid #eaeef2; border-radius:20px; padding:1rem; margin:1rem 0;">
                <legend>ğŸ“¦ Productos</legend>
                <div id="productsContainer"></div>
                <button type="button" id="addProductBtn" class="secondary" style="margin-top:0.5rem">â• Agregar</button>
            </fieldset>
            <div style="display:flex; gap:1rem; justify-content:flex-end; margin-top:2rem;">
                <button type="button" id="cancelOrderBtn" class="secondary">Cancelar</button>
                <button type="submit" id="saveOrderBtn">Guardar</button>
            </div>
        </form>
    </div>
</div>

<div id="quickCustomerModal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); align-items:center; justify-content:center; z-index:1100;">
    <div style="background:white; border-radius:30px; width:90%; max-width:400px; padding:2rem;">
        <h3>â• Cliente RÃ¡pido</h3>
        <form id="quickCustomerForm">
            <div class="form-group">
                <label>Nombre *</label>
                <input type="text" id="quickName" required>
            </div>
            <div class="form-group">
                <label>TelÃ©fono</label>
                <input type="text" id="quickPhone">
            </div>
            <div class="form-group">
                <label>DirecciÃ³n</label>
                <input type="text" id="quickAddress">
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="quickEmail">
            </div>
            <div style="display:flex; gap:1rem; justify-content:flex-end; margin-top:1.5rem;">
                <button type="button" id="cancelQuickBtn" class="secondary">Cancelar</button>
                <button type="submit" id="saveQuickBtn">Guardar y usar</button>
            </div>
        </form>
    </div>
</div>

<div id="imageModal" class="image-modal" style="display:none;" onclick="this.style.display='none'">
    <span class="close">&times;</span>
    <img id="modalImage" src="" alt="Foto">
</div>

<div id="customerModal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); align-items:center; justify-content:center; z-index:1000;">
    <div style="background:white; border-radius:30px; width:90%; max-width:500px; padding:2rem;">
        <h3 id="customerModalTitle">ğŸ‘¤ Nuevo Cliente</h3>
        <form id="customerForm">
            <input type="hidden" id="customerId">
            <div class="form-group">
                <label>Nombre *</label>
                <input type="text" id="customerName" required>
            </div>
            <div class="form-group">
                <label>TelÃ©fono</label>
                <input type="text" id="customerPhone">
            </div>
            <div class="form-group">
                <label>DirecciÃ³n</label>
                <input type="text" id="customerAddress">
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="customerEmail">
            </div>
            <div style="display:flex; gap:1rem; justify-content:flex-end; margin-top:2rem;">
                <button type="button" id="cancelCustomerBtn" class="secondary">Cancelar</button>
                <button type="submit" id="saveCustomerBtn">Guardar</button>
            </div>
        </form>
    </div>
</div>

<div id="globalLoader" class="global-loader hidden">
    <div class="spinner" style="width:50px; height:50px;"></div>
</div>

<!-- Script principal -->
<script src="app.js"></script>
</body>
</html>
